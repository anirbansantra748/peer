<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      padding: 20px;
      line-height: 1.6;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    
    header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #21262d;
    }
    h1 { 
      font-size: 32px; 
      font-weight: 600;
      color: #58a6ff;
    }
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #30363d;
    }
    .nav-links {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .nav-links a {
      color: #8b949e;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .nav-links a:hover {
      color: #58a6ff;
      background: #161b22;
    }
    .nav-links a.active {
      color: #fff;
      background: #21262d;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: #161b22;
      border-radius: 8px;
      border: 1px dashed #30363d;
    }
    .empty-state h2 {
      color: #8b949e;
      font-size: 20px;
      margin-bottom: 10px;
    }
    .empty-state p {
      color: #6e7681;
      margin-bottom: 20px;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #238636;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #2ea043;
    }
    .btn-secondary {
      background: #21262d;
      color: #c9d1d9;
    }
    .btn-secondary:hover {
      background: #30363d;
    }

    .installation-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .installation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #21262d;
    }
    .installation-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .installation-title h2 {
      font-size: 20px;
      font-weight: 600;
      color: #c9d1d9;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge.active {
      background: #238636;
      color: white;
    }
    .badge.suspended {
      background: #da3633;
      color: white;
    }
    .badge.all {
      background: #1f6feb;
      color: white;
    }
    .badge.selected {
      background: #8b949e;
      color: white;
    }

    .config-section {
      margin-top: 20px;
      padding: 15px;
      background: #0d1117;
      border-radius: 6px;
      border: 1px solid #21262d;
    }
    .config-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #21262d;
    }
    .config-row:last-child {
      border-bottom: none;
    }
    .config-label {
      color: #8b949e;
      font-weight: 500;
    }
    .config-value {
      color: #c9d1d9;
    }
    .severity-tags {
      display: flex;
      gap: 6px;
    }
    .severity-tag {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .severity-critical { background: #da3633; color: white; }
    .severity-high { background: #f85149; color: white; }
    .severity-medium { background: #d29922; color: white; }
    .severity-low { background: #768390; color: white; }

    .repos-list {
      margin-top: 15px;
    }
    .repo-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #0d1117;
      border: 1px solid #21262d;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: background 0.2s;
    }
    .repo-item:hover {
      background: #161b22;
    }
    .repo-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .repo-icon {
      width: 16px;
      height: 16px;
    }
    .repo-name {
      color: #58a6ff;
      font-weight: 500;
    }
    .repo-private {
      color: #6e7681;
      font-size: 12px;
      margin-left: 8px;
    }
    .repo-actions {
      display: flex;
      gap: 8px;
    }
    .action-link {
      color: #8b949e;
      text-decoration: none;
      font-size: 13px;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .action-link:hover {
      color: #58a6ff;
      background: #21262d;
    }

    .install-btn {
      margin-top: 30px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>GitHub App Installations</h1>
      <% if (user) { %>
      <div class="user-info">
        <img src="<%= user.avatarUrl %>" alt="<%= user.username %>">
        <span><%= user.username %></span>
        <a href="/auth/logout" class="btn btn-secondary">Logout</a>
      </div>
      <% } %>
    </header>

    <div class="nav-links">
      <a href="/">Dashboard</a>
      <a href="/installations" class="active">Installations</a>
    </div>

    <% if (installations.length === 0) { %>
      <div class="empty-state">
        <h2>No Installations Found</h2>
        <p>You haven't installed the Peer GitHub App on any repositories yet.</p>
        <p style="color: #8b949e; font-size: 14px; margin-top: 16px;">
          Go to your GitHub repository â†’ Settings â†’ Integrations â†’ GitHub Apps â†’ Search for "Peer Code Review v2" â†’ Install
        </p>
        <a href="https://github.com/apps/peer-code-review-v2/installations/new" target="_blank" class="btn">Install GitHub App</a>
      </div>
    <% } else { %>
      <% installations.forEach(installation => { %>
        <div class="installation-card">
          <div class="installation-header">
            <div class="installation-title">
              <h2><%= installation.accountLogin %></h2>
              <span class="badge <%= installation.status %>"><%= installation.status.toUpperCase() %></span>
              <span class="badge <%= installation.repositorySelection %>">
                <%= installation.repositorySelection === 'all' ? 'All Repos' : `${installation.repositories.length} Repos` %>
              </span>
            </div>
            <a href="/installations/<%= installation._id %>/settings" class="btn btn-secondary">Configure</a>
          </div>

          <div class="config-section">
            <h3 style="color: #8b949e; font-size: 14px; margin-bottom: 10px; font-weight: 600;">CURRENT CONFIGURATION</h3>
            <div class="config-row">
              <span class="config-label">Processing Mode</span>
              <span class="config-value"><strong><%= installation.config.mode.toUpperCase() %></strong></span>
            </div>
            <div class="config-row">
              <span class="config-label">Severity Levels</span>
              <div class="severity-tags">
                <% installation.config.severities.forEach(severity => { %>
                  <span class="severity-tag severity-<%= severity %>"><%= severity %></span>
                <% }); %>
              </div>
            </div>
            <div class="config-row">
              <span class="config-label">Max Files Per Run</span>
              <span class="config-value"><%= installation.config.maxFilesPerRun %></span>
            </div>
            <div class="config-row">
              <span class="config-label">Auto-Merge</span>
              <span class="config-value">
                <%= installation.config.autoMerge.enabled ? 'âœ“ Enabled' : 'âœ— Disabled' %>
              </span>
            </div>
          </div>

          <div class="repos-list">
            <h3 style="color: #8b949e; font-size: 14px; margin: 15px 0 10px; font-weight: 600;">
              REPOSITORIES (<%= installation.repositories.length %>)
            </h3>
            <% if (installation.repositories.length === 0) { %>
              <p style="color: #6e7681; padding: 15px; text-align: center;">No repositories selected</p>
            <% } else { %>
              <% installation.repositories.slice(0, 5).forEach(repo => { %>
                <div class="repo-item">
                  <div class="repo-info">
                    <svg class="repo-icon" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
                    </svg>
                    <span class="repo-name"><%= repo.fullName %></span>
                    <% if (repo.private) { %>
                      <span class="repo-private">ðŸ”’ Private</span>
                    <% } %>
                  </div>
                  <div class="repo-actions">
                    <a href="<%= repo.url %>" target="_blank" class="action-link">View â†’</a>
                  </div>
                </div>
              <% }); %>
              <% if (installation.repositories.length > 5) { %>
                <p style="color: #6e7681; text-align: center; margin-top: 10px; font-size: 13px;">
                  + <%= installation.repositories.length - 5 %> more repositories
                </p>
              <% } %>
            <% } %>
          </div>

          <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #21262d; color: #6e7681; font-size: 12px;">
            <strong>Installation ID:</strong> <%= installation.installationId %> | 
            <strong>Installed:</strong> <%= new Date(installation.installedAt).toLocaleDateString() %>
          </div>
        </div>
      <% }); %>
    <% } %>

    <div class="install-btn">
      <a href="https://github.com/apps/peer-code-review-v2/installations/new" target="_blank" class="btn">
        + Add More Repositories
      </a>
    </div>
  </div>
</body>
</html>
