<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Peer Code Review' %></title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
      :root {
        /* Dark theme (default) */
        --bg-primary: #0d1117;
        --bg-secondary: #161b22;
        --bg-tertiary: #21262d;
        --border-primary: #30363d;
        --border-secondary: #21262d;
        --text-primary: #c9d1d9;
        --text-secondary: #8b949e;
        --text-tertiary: #6e7681;
        --accent-primary: #58a6ff;
        --accent-hover: #79c0ff;
        --success: #238636;
        --success-light: #2ea043;
        --warning: #f0883e;
        --danger: #da3633;
        --danger-light: #ff7b72;
      }
      
      body.light-theme {
        /* Light theme */
        --bg-primary: #ffffff;
        --bg-secondary: #f6f8fa;
        --bg-tertiary: #ffffff;
        --border-primary: #d0d7de;
        --border-secondary: #d8dee4;
        --text-primary: #24292f;
        --text-secondary: #57606a;
        --text-tertiary: #6e7781;
        --accent-primary: #0969da;
        --accent-hover: #0550ae;
        --success: #1a7f37;
        --success-light: #1f8839;
        --warning: #9a6700;
        --danger: #cf222e;
        --danger-light: #a40e26;
      }
      
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        transition: background 0.3s ease, color 0.3s ease;
      }
      
      /* Premium Navbar Styles */
      .navbar {
        background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(13, 17, 23, 0.98) 100%);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(88, 166, 255, 0.15);
        padding: 16px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        transition: all 0.3s ease;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      }
      
      .navbar::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent 0%, rgba(88, 166, 255, 0.3) 50%, transparent 100%);
      }
      
      .navbar-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 32px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .navbar-brand {
        font-size: 24px;
        font-weight: 900;
        background: linear-gradient(135deg, #58a6ff 0%, #79c0ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 12px;
        letter-spacing: -0.02em;
        transition: all 0.3s ease;
      }
      
      .navbar-brand:hover {
        transform: translateY(-2px);
        filter: drop-shadow(0 4px 12px rgba(88, 166, 255, 0.4));
      }
      
      .navbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      
      /* Profile dropdown */
      .profile-dropdown {
        position: relative;
      }
      .profile-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .profile-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 2px solid var(--border-primary);
        transition: border-color 0.2s;
      }
      .profile-btn:hover .profile-avatar {
        border-color: var(--accent-primary);
      }
      .profile-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        margin-top: 8px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        min-width: 280px;
        z-index: 1000;
      }
      .profile-dropdown:hover .profile-menu,
      .profile-dropdown:focus-within .profile-menu {
        display: block;
      }
      .profile-header {
        padding: 16px;
        border-bottom: 1px solid var(--border-secondary);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .profile-header-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--border-primary);
      }
      .profile-info h4 {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
      }
      .profile-info p {
        font-size: 12px;
        color: var(--text-secondary);
      }
      .profile-menu-section {
        padding: 8px 0;
        border-bottom: 1px solid var(--border-secondary);
      }
      .profile-menu-section:last-child {
        border-bottom: none;
      }
      .profile-menu-item {
        display: block;
        padding: 10px 16px;
        color: var(--text-primary);
        text-decoration: none;
        font-size: 14px;
        transition: background 0.2s;
      }
      .profile-menu-item:hover {
        background: var(--bg-primary);
        color: var(--accent-primary);
      }
      .profile-menu-label {
        padding: 8px 16px;
        font-size: 11px;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      /* Theme toggle */
      .theme-toggle {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        color: var(--text-primary);
        width: 36px;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s;
      }
      .theme-toggle:hover {
        background: var(--border-primary);
        border-color: var(--accent-primary);
      }
      
      /* Settings button */
      .settings-btn {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        color: var(--text-primary);
        width: 36px;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s;
      }
      .settings-btn:hover {
        background: var(--border-primary);
        border-color: var(--accent-primary);
      }
      .settings-dropdown {
        position: relative;
      }
      .settings-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        margin-top: 12px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        min-width: 220px;
        z-index: 1000;
        padding: 8px 0;
        animation: dropdown-appear 0.2s ease-out;
      }
      
      @keyframes dropdown-appear {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .settings-dropdown.open .settings-menu {
        display: block;
      }
      .settings-menu a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 18px;
        color: var(--text-primary);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        border-radius: 8px;
        margin: 0 8px;
      }
      .settings-menu a:hover {
        background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, rgba(88, 166, 255, 0.05) 100%);
        color: var(--accent-primary);
        transform: translateX(4px);
      }
      
      /* Main content */
      .main-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px 20px;
        min-height: calc(100vh - 200px);
      }
      
      /* Premium Footer */
      .footer {
        background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(13, 17, 23, 0.98) 100%);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(88, 166, 255, 0.15);
        margin-top: 80px;
        position: relative;
      }
      
      .footer::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent 0%, rgba(88, 166, 255, 0.3) 50%, transparent 100%);
      }
      
      .footer-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 60px 32px 40px;
      }
      
      .footer-content {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr;
        gap: 60px;
        margin-bottom: 48px;
      }
      
      .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .footer-brand-title {
        font-size: 28px;
        font-weight: 900;
        background: linear-gradient(135deg, #58a6ff 0%, #79c0ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .footer-brand-desc {
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.6;
        max-width: 300px;
      }
      
      .footer-social {
        display: flex;
        gap: 12px;
        margin-top: 8px;
      }
      
      .footer-social-link {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(88, 166, 255, 0.1);
        border: 1px solid rgba(88, 166, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        font-size: 20px;
        transition: all 0.3s ease;
      }
      
      .footer-social-link:hover {
        background: rgba(88, 166, 255, 0.2);
        border-color: rgba(88, 166, 255, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 4px 16px rgba(88, 166, 255, 0.3);
      }
      
      .footer-section {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .footer-section-title {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-primary);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
      }
      
      .footer-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      
      .footer-link:hover {
        color: var(--accent-primary);
        transform: translateX(4px);
      }
      
      .footer-bottom {
        padding-top: 32px;
        border-top: 1px solid rgba(88, 166, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }
      
      .footer-bottom-text {
        color: var(--text-tertiary);
        font-size: 13px;
      }
      
      .footer-bottom-links {
        display: flex;
        gap: 24px;
      }
      
      .footer-bottom-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 13px;
        transition: color 0.2s ease;
      }
      
      .footer-bottom-link:hover {
        color: var(--accent-primary);
      }
      
      @media (max-width: 968px) {
        .footer-content {
          grid-template-columns: repeat(2, 1fr);
          gap: 40px;
        }
      }
      
      @media (max-width: 640px) {
        .footer-content {
          grid-template-columns: 1fr;
          gap: 32px;
        }
        
        .footer-bottom {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
    <% if (typeof blocks !== 'undefined' && blocks.additionalStyles) { %><%- blocks.additionalStyles %><% } %>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="navbar-container">
        <a href="/" class="navbar-brand">
          🤖 Peer
        </a>
        
        <div class="navbar-right">
          <!-- Theme Toggle -->
          <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
            <span id="theme-icon">🌙</span>
          </button>
          
          <!-- Settings Dropdown -->
          <div class="settings-dropdown">
            <button class="settings-btn">⚙️</button>
            <div class="settings-menu">
              <a href="/profile-settings">👤 Profile & Email</a>
              <a href="/notification-preferences">🔔 Notifications</a>
              <a href="/settings/api-keys">🔑 API Keys</a>
              <a href="/settings/subscription">💎 Subscription</a>
            </div>
          </div>
          
          <!-- Profile Dropdown -->
          <div class="profile-dropdown">
            <button class="profile-btn">
              <img src="<%= user.avatar || 'https://github.com/' + user.username + '.png?size=64' %>" 
                   alt="<%= user.username %>" 
                   class="profile-avatar"
                   onerror="this.src='https://github.com/identicons/' + '<%= user.githubId %>' + '.png'">
            </button>
            <div class="profile-menu">
              <div class="profile-header">
                <img src="<%= user.avatar || 'https://github.com/' + user.username + '.png?size=64' %>" 
                     alt="<%= user.username %>" 
                     class="profile-header-avatar"
                     onerror="this.src='https://github.com/identicons/' + '<%= user.githubId %>' + '.png'">
                <div class="profile-info">
                  <h4><%= user.displayName || user.username %></h4>
                  <p>@<%= user.username %></p>
                </div>
              </div>
              
              <div class="profile-menu-section">
                <div class="profile-menu-label">GitHub</div>
                <a href="https://github.com/<%= user.username %>" target="_blank" class="profile-menu-item">
                  🔗 View GitHub Profile
                </a>
                <a href="https://github.com/<%= user.username %>?tab=repositories" target="_blank" class="profile-menu-item">
                  📦 Your Repositories
                </a>
                <a href="https://github.com/pulls" target="_blank" class="profile-menu-item">
                  🔀 Your Pull Requests
                </a>
              </div>
              
              <div class="profile-menu-section">
                <a href="/installations" class="profile-menu-item">
                  🔧 Manage Installations
                </a>
                <a href="/audit" class="profile-menu-item">
                  📊 Audit Logs
                </a>
              </div>
              
              <div class="profile-menu-section">
                <a href="/auth/logout" class="profile-menu-item" style="color: #f85149;">
                  🚪 Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Main Content -->
    <div class="main-content">
      <%- body %>
    </div>
    
    <!-- Premium Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-content">
          <!-- Brand Section -->
          <div class="footer-brand">
            <div class="footer-brand-title">
              🤖 Peer
            </div>
            <p class="footer-brand-desc">
              AI-powered code review and automated fixes for your GitHub repositories. Ship better code faster.
            </p>
            <div class="footer-social">
              <a href="https://github.com" target="_blank" class="footer-social-link" title="GitHub">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #58a6ff;">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                </svg>
              </a>
              <a href="https://twitter.com" target="_blank" class="footer-social-link" title="Twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #58a6ff;">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
              </a>
              <a href="mailto:hello@peer.dev" class="footer-social-link" title="Email">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #58a6ff;">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                  <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
              </a>
            </div>
          </div>
          
          <!-- Product Section -->
          <div class="footer-section">
            <div class="footer-section-title">Product</div>
            <a href="/" class="footer-link">→ Dashboard</a>
            <a href="/repos" class="footer-link">→ Repositories</a>
            <a href="/installations" class="footer-link">→ Installations</a>
            <a href="/audits" class="footer-link">→ Audit Logs</a>
          </div>
          
          <!-- Resources Section -->
          <div class="footer-section">
            <div class="footer-section-title">Resources</div>
            <a href="/settings/api-keys" class="footer-link">→ API Keys</a>
            <a href="/settings/subscription" class="footer-link">→ Subscription</a>
            <a href="https://github.com" target="_blank" class="footer-link">→ Documentation</a>
            <a href="https://github.com" target="_blank" class="footer-link">→ API Reference</a>
          </div>
          
          <!-- Company Section -->
          <div class="footer-section">
            <div class="footer-section-title">Company</div>
            <a href="#" class="footer-link">→ About Us</a>
            <a href="#" class="footer-link">→ Privacy Policy</a>
            <a href="#" class="footer-link">→ Terms of Service</a>
            <a href="#" class="footer-link">→ Contact</a>
          </div>
        </div>
        
        <div class="footer-bottom">
          <div class="footer-bottom-text">
            © <%= new Date().getFullYear() %> Peer. All rights reserved.
          </div>
          <div class="footer-bottom-links">
            <a href="#" class="footer-bottom-link">Status</a>
            <a href="#" class="footer-bottom-link">Security</a>
            <a href="#" class="footer-bottom-link">Changelog</a>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Toast Notifications -->
    <%- include('partials/toast-notifications') %>
    
    <!-- Theme Toggle & Settings Dropdown Scripts -->
    <script>
      (function() {
        // Theme Toggle
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        
        const savedTheme = localStorage.getItem('theme') || 'dark';
        
        function setTheme(theme) {
          if (theme === 'light') {
            document.body.classList.add('light-theme');
            themeIcon.textContent = '☀️';
            localStorage.setItem('theme', 'light');
          } else {
            document.body.classList.remove('light-theme');
            themeIcon.textContent = '🌙';
            localStorage.setItem('theme', 'dark');
          }
        }
        
        setTheme(savedTheme);
        
        themeToggle.addEventListener('click', () => {
          const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          setTheme(newTheme);
        });
        
        // Persistent Settings Dropdown
        const settingsDropdown = document.querySelector('.settings-dropdown');
        const settingsBtn = document.querySelector('.settings-btn');
        const settingsMenu = document.querySelector('.settings-menu');
        let closeTimeout;
        
        function openSettings() {
          clearTimeout(closeTimeout);
          settingsDropdown.classList.add('open');
        }
        
        function closeSettings() {
          closeTimeout = setTimeout(() => {
            settingsDropdown.classList.remove('open');
          }, 300); // 300ms delay before closing
        }
        
        // Click to toggle
        settingsBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (settingsDropdown.classList.contains('open')) {
            settingsDropdown.classList.remove('open');
          } else {
            openSettings();
          }
        });
        
        // Keep open when hovering over dropdown or menu
        settingsDropdown.addEventListener('mouseenter', openSettings);
        settingsDropdown.addEventListener('mouseleave', closeSettings);
        
        // Close when clicking outside
        document.addEventListener('click', (e) => {
          if (!settingsDropdown.contains(e.target)) {
            settingsDropdown.classList.remove('open');
          }
        });
      })();
    </script>
    
    <% if (typeof blocks !== 'undefined' && blocks.additionalScripts) { %><%- blocks.additionalScripts %><% } %>
  </body>
</html>
