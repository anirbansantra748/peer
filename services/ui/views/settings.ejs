<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      padding: 20px;
      line-height: 1.6;
    }
    .container { max-width: 800px; margin: 0 auto; }
    
    header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #21262d;
    }
    h1 { 
      font-size: 28px; 
      font-weight: 600;
      color: #58a6ff;
    }
    .back-link {
      color: #8b949e;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .back-link:hover {
      color: #58a6ff;
    }

    .form-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 24px;
    }
    .form-section {
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid #21262d;
    }
    .form-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .form-section h2 {
      font-size: 18px;
      color: #c9d1d9;
      margin-bottom: 8px;
    }
    .form-section p {
      color: #8b949e;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      color: #c9d1d9;
      font-weight: 500;
      margin-bottom: 8px;
      font-size: 14px;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #c9d1d9;
      font-size: 14px;
    }
    select:focus, input:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .checkbox-item:hover {
      background: #161b22;
    }
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      flex: 1;
    }
    .severity-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .severity-critical { background: #da3633; color: white; }
    .severity-high { background: #f85149; color: white; }
    .severity-medium { background: #d29922; color: white; }
    .severity-low { background: #768390; color: white; }

    .info-box {
      padding: 12px;
      background: #1f6feb20;
      border: 1px solid #1f6feb;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 13px;
      color: #79c0ff;
    }
    .warning-box {
      padding: 12px;
      background: #d2992220;
      border: 1px solid #d29922;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 13px;
      color: #f0b72f;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-primary {
      background: #238636;
      color: white;
    }
    .btn-primary:hover {
      background: #2ea043;
    }
    .btn-secondary {
      background: #21262d;
      color: #c9d1d9;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    .btn-secondary:hover {
      background: #30363d;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Configure Installation</h1>
      <a href="/installations" class="back-link">← Back to Installations</a>
    </header>

    <div class="form-card">
      <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #21262d;">
        <h2 style="color: #c9d1d9; font-size: 20px; margin-bottom: 5px;"><%= installation.accountLogin %></h2>
        <p style="color: #6e7681; font-size: 14px;">Installation ID: <%= installation.installationId %></p>
      </div>

      <form method="POST" action="/installations/<%= installation._id %>/settings">
        <!-- Processing Mode -->
        <div class="form-section">
          <h2>Processing Mode</h2>
          <p>Choose how Peer should handle pull requests automatically</p>
          
          <div class="form-group">
            <label for="mode">Mode</label>
            <select name="mode" id="mode">
              <option value="analyze" <%= installation.config.mode === 'analyze' ? 'selected' : '' %>>
                Analyze Only - Just analyze and comment (recommended)
              </option>
              <option value="commit" <%= installation.config.mode === 'commit' ? 'selected' : '' %>>
                Commit Fixes - Auto-create commits with fixes
              </option>
              <option value="merge" <%= installation.config.mode === 'merge' ? 'selected' : '' %>>
                Auto-Merge - Automatically merge approved PRs (dangerous)
              </option>
            </select>
            <div class="info-box">
              <strong>Analyze:</strong> Peer will analyze PRs and post comments with findings. No code changes.<br>
              <strong>Commit:</strong> Peer will create commits with automatic fixes to your PR branch.<br>
              <strong>Merge:</strong> Peer will automatically merge PRs that pass all checks (use with caution).
            </div>
          </div>
        </div>

        <!-- Severity Levels -->
        <div class="form-section">
          <h2>Severity Levels</h2>
          <p>Select which severity levels you want to analyze and report</p>
          
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="severities" 
                value="critical" 
                id="sev-critical"
                <%= installation.config.severities.includes('critical') ? 'checked' : '' %>
              >
              <label for="sev-critical">
                <span class="severity-badge severity-critical">Critical</span>
                Security vulnerabilities, data loss risks
              </label>
            </div>
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="severities" 
                value="high" 
                id="sev-high"
                <%= installation.config.severities.includes('high') ? 'checked' : '' %>
              >
              <label for="sev-high">
                <span class="severity-badge severity-high">High</span>
                Major bugs, performance issues
              </label>
            </div>
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="severities" 
                value="medium" 
                id="sev-medium"
                <%= installation.config.severities.includes('medium') ? 'checked' : '' %>
              >
              <label for="sev-medium">
                <span class="severity-badge severity-medium">Medium</span>
                Code quality, minor bugs
              </label>
            </div>
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="severities" 
                value="low" 
                id="sev-low"
                <%= installation.config.severities.includes('low') ? 'checked' : '' %>
              >
              <label for="sev-low">
                <span class="severity-badge severity-low">Low</span>
                Style issues, suggestions
              </label>
            </div>
          </div>
          <div class="info-box">
            Select at least one severity level. Only issues matching these levels will be reported.
          </div>
        </div>

        <!-- Performance Settings -->
        <div class="form-section">
          <h2>Performance Limits</h2>
          <p>Control how many files Peer will process per PR</p>
          
          <div class="form-group">
            <label for="maxFilesPerRun">Maximum Files Per Run</label>
            <input 
              type="number" 
              name="maxFilesPerRun" 
              id="maxFilesPerRun"
              min="1"
              max="50"
              value="<%= installation.config.maxFilesPerRun %>"
            >
            <div class="info-box">
              Limit how many files to analyze per PR run. Lower values = faster analysis, higher values = more thorough.
            </div>
          </div>
        </div>

        <!-- Auto-Merge Settings -->
        <div class="form-section">
          <h2>Auto-Merge Settings</h2>
          <p>Configure automatic PR merging (only applies when mode is set to "merge")</p>
          
          <div class="form-group">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="autoMergeEnabled" 
                id="autoMergeEnabled"
                <%= installation.config.autoMerge.enabled ? 'checked' : '' %>
              >
              <label for="autoMergeEnabled">Enable Auto-Merge</label>
            </div>
          </div>

          <div class="form-group">
            <div class="checkbox-item">
              <input 
                type="checkbox" 
                name="requireTests" 
                id="requireTests"
                <%= installation.config.autoMerge.requireTests ? 'checked' : '' %>
              >
              <label for="requireTests">Require Tests to Pass</label>
            </div>
          </div>

          <div class="form-group">
            <label for="requireReviews">Required Approvals</label>
            <input 
              type="number" 
              name="requireReviews" 
              id="requireReviews"
              min="0"
              max="10"
              value="<%= installation.config.autoMerge.requireReviews %>"
            >
          </div>

          <div class="warning-box">
            ⚠️ <strong>Warning:</strong> Auto-merge is a powerful feature. Make sure you have proper checks and reviews configured.
          </div>
        </div>

        <div class="button-group">
          <button type="submit" class="btn btn-primary">Save Configuration</button>
          <a href="/installations" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
